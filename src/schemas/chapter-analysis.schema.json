{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/chapter-analysis.schema.json",
  "title": "Chapter Analysis",
  "description": "A comprehensive schema for multi-pass chapter analysis including comprehension, structure, propositions, and metadata.",
  "type": "object",
  "properties": {
    "system_metadata": {
      "type": "object",
      "description": "Backend header metadata about the chapter",
      "properties": {
        "chapter_id": { "type": ["string", "null"] },
        "file_name": { "type": ["string", "null"] },
        "author_or_editor": { "type": ["string", "null"] },
        "version": { "type": ["string", "null"] },
        "created_at": { "type": ["string", "null"], "format": "date-time" },
        "source_text": { "type": ["string", "null"] }
      }
    },
    "comprehension_pass": {
      "type": "object",
      "description": "First-pass comprehension using 5W1H framework",
      "properties": {
        "who": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "entity": { "type": "string" },
              "role_or_function": { "type": ["string", "null"] },
              "significance_in_chapter": { "type": ["string", "null"] },
              "evidence_pointer": { "type": ["string", "null"] }
            },
            "required": ["entity"]
          }
        },
        "what": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "concept_or_topic": { "type": "string" },
              "definition_or_description": { "type": ["string", "null"] },
              "importance": { "type": ["string", "null"] },
              "evidence_pointer": { "type": ["string", "null"] }
            },
            "required": ["concept_or_topic"]
          }
        },
        "when": {
          "type": "object",
          "properties": {
            "historical_or_cultural_context": { "type": ["string", "null"] },
            "chronological_sequence_within_course": { "type": ["string", "null"] },
            "moment_of_presentation_to_reader": { "type": ["string", "null"] }
          }
        },
        "why": {
          "type": "object",
          "properties": {
            "intellectual_value": { "type": ["string", "null"] },
            "knowledge_based_value": { "type": ["string", "null"] },
            "moral_or_philosophical_significance": { "type": ["string", "null"] }
          }
        },
        "how": {
          "type": "object",
          "properties": {
            "presentation_style": { "type": ["string", "null"] },
            "rhetorical_approach": { "type": ["string", "null"] },
            "recommended_student_strategy": { "type": ["string", "null"] }
          }
        }
      },
      "required": ["who", "what", "when", "why", "how"]
    },
    "structural_outline": {
      "type": "object",
      "description": "Hierarchical outline of chapter structure",
      "properties": {
        "chapter_title": { "type": "string" },
        "guiding_context_questions": {
          "type": "array",
          "items": { "type": "string" }
        },
        "outline": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "section_title": { "type": "string" },
              "section_summary": { "type": ["string", "null"] },
              "pedagogical_purpose": { "type": ["string", "null"] },
              "rhetorical_mode": {
                "type": ["string", "null"],
                "enum": ["expository", "narrative", "analytical", "reflective", "procedural", null]
              },
              "subtopics": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "subtopic_title": { "type": "string" },
                    "key_concepts": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "supporting_examples": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "student_discussion_prompts": {
                      "type": "array",
                      "items": { "type": "string" }
                    },
                    "notes_on_instructional_sequence": { "type": ["string", "null"] },
                    "sub_subtopics": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "title": { "type": "string" },
                          "details": { "type": ["string", "null"] },
                          "visual_or_media_support": { "type": ["string", "null"] }
                        },
                        "required": ["title"]
                      }
                    }
                  },
                  "required": ["subtopic_title"]
                }
              }
            },
            "required": ["section_title"]
          }
        }
      },
      "required": ["chapter_title", "outline"]
    },
    "propositional_extraction": {
      "type": "object",
      "description": "Extracted propositions with truth-type classification",
      "properties": {
        "definition": { "type": ["string", "null"] },
        "guiding_prompts": {
          "type": "array",
          "items": { "type": "string" }
        },
        "propositions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": ["string", "null"] },
              "truth_type": {
                "type": ["string", "null"],
                "enum": ["descriptive", "analytical", "normative", null]
              },
              "statement": { "type": "string" },
              "evidence_from_text": { "type": ["string", "null"] },
              "implication_for_learning": { "type": ["string", "null"] },
              "connections_to_other_chapters": {
                "type": "array",
                "items": { "type": "string" }
              },
              "potential_student_reflection_question": { "type": ["string", "null"] },
              "evidence_pointer": { "type": ["string", "null"] }
            },
            "required": ["statement"]
          }
        }
      },
      "required": ["propositions"]
    },
    "analytical_metadata": {
      "type": "object",
      "description": "Derived metadata for curriculum placement and connections",
      "properties": {
        "subject_domain": { "type": ["string", "null"] },
        "curriculum_unit": { "type": ["string", "null"] },
        "disciplinary_lens": { "type": ["string", "null"] },
        "related_chapters": {
          "type": "array",
          "items": { "type": "string" }
        },
        "grade_level_or_audience": { "type": ["string", "null"] },
        "spiral_position": { "type": ["string", "null"] }
      }
    },
    "critical_reflection": {
      "type": "object",
      "description": "Optional critical analysis and reflection"
    },
    "pedagogical_mapping": {
      "type": "object",
      "description": "Pedagogical elements and learning support",
      "properties": {
        "learning_objectives": {
          "type": "array",
          "description": "Explicit learning objectives or goals stated in the chapter",
          "items": { "type": "string" }
        },
        "student_activities": {
          "type": "array",
          "description": "Interactive exercises, BYLINE activities, or hands-on tasks for students",
          "items": {
            "type": "object",
            "properties": {
              "activity_type": { "type": ["string", "null"], "description": "Type of activity (e.g., 'reflection', 'observation', 'experiment', 'discussion')" },
              "description": { "type": ["string", "null"], "description": "What the activity asks students to do" },
              "location": { "type": ["string", "null"], "description": "Where in the chapter this appears" }
            }
          }
        },
        "assessment_questions": {
          "type": "array",
          "description": "Knowledge check questions, quizzes, or self-assessment prompts",
          "items": {
            "type": "object",
            "properties": {
              "question": { "type": ["string", "null"] },
              "question_type": { "type": ["string", "null"], "description": "Type of question (e.g., 'multiple choice', 'true/false', 'short answer')" },
              "location": { "type": ["string", "null"] }
            }
          }
        },
        "chapter_summary": {
          "type": ["string", "null"],
          "description": "Summary or key takeaways provided at chapter end"
        },
        "review_sections": {
          "type": "array",
          "description": "REVIEW boxes or summary statements throughout the chapter",
          "items": {
            "type": "object",
            "properties": {
              "content": { "type": ["string", "null"], "description": "The review statement or summary" },
              "location": { "type": ["string", "null"] }
            }
          }
        },
        "visual_media_references": {
          "type": "array",
          "description": "Figures, diagrams, images, or other visual content referenced",
          "items": {
            "type": "object",
            "properties": {
              "reference": { "type": ["string", "null"], "description": "Figure number or description (e.g., 'Figure 1.3', 'Peter-Paul goblet illusion')" },
              "description": { "type": ["string", "null"], "description": "What the visual depicts" },
              "pedagogical_purpose": { "type": ["string", "null"], "description": "Why this visual is included" }
            }
          }
        },
        "temporal_analysis": {
          "type": ["object", "null"],
          "description": "Analysis of the temporal range of examples and content currency",
          "properties": {
            "historical_examples": {
              "type": "array",
              "description": "Examples from the past that provide historical context",
              "items": {
                "type": "object",
                "properties": {
                  "example": { "type": ["string", "null"] },
                  "time_period": { "type": ["string", "null"] },
                  "still_relevant": { "type": ["boolean", "null"], "description": "Is this example still pedagogically valuable?" }
                }
              }
            },
            "contemporary_examples": {
              "type": "array",
              "description": "Current/modern examples that may need future updating",
              "items": {
                "type": "object",
                "properties": {
                  "example": { "type": ["string", "null"] },
                  "current_as_of": { "type": ["string", "null"], "description": "Year or date this example is current" },
                  "update_priority": { "type": ["string", "null"], "enum": ["low", "medium", "high"], "description": "How urgently this may need updating" }
                }
              }
            },
            "temporal_range": { "type": ["string", "null"], "description": "Overall time span covered by examples (e.g., '1920s-2025')" }
          }
        },
        "potential_discussion_questions": {
          "type": "array",
          "description": "Additional discussion questions for end-of-chapter reflection",
          "items": { "type": "string" }
        }
      }
    }
  },
  "required": ["comprehension_pass", "structural_outline", "propositional_extraction"],
  "additionalProperties": false
}
